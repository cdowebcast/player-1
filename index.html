<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Media Player</title>
    <link rel="stylesheet" href="main.css" type="text/css" media="screen">
</head>
<body>
    <div id="container"
        <table id="browser" cellspacing="0" cellpadding="0">
            <tr>
                <th id="artistHead">
                    <a href="#">Artists</a>
                </th>
                <th id="albumHead">
                    <a href="#">Albums</a>
                </th>
            </tr>
            <tr>
                <td id="artistPane" class="pane">
                    <ol>
                        <li class="odd selected">
                            <a href="#">The Lemonheads</a>
                        </li>
                        <li class="even">
                            <a href="#">Michael Jackson</a>
                        </li>
                        <li class="odd">
                            <a href="#">Radiohead</a>
                        </li>
                        <li class="even">
                            <a href="#">Avril Lavigne</a>
                        </li>
                        <li class="odd">
                            <a href="#">Coldplay</a>
                        </li>
                        <li class="even">
                            <a href="#">Honty and the Sea monkeys</a>
                        </li>
                        <li class="odd">
                            <a href="#">James Wheare</a>
                        </li>
                        <li class="even">
                            <a href="#">Mokele</a>
                        </li>
                        <li class="odd">
                            <a href="#">Ben Folds</a>
                        </li>
                        <li class="even">
                            <a href="#">Foo Fighters</a>
                        </li>
                    </ol>
                </td>
                <td id="albumPane" class="pane">
                    <ol>
                        <li class="odd">
                            <a href="#">Lick</a>
                        </li>
                        <li class="even">
                            <a href="#">Lovey</a>
                        </li>
                        <li class="odd">
                            <a href="#">The Lemonheads</a>
                        </li>
                        <li class="even">
                            <a href="#">Hate Your Friends</a>
                        </li>
                        <li class="odd selected">
                            <a href="#">It's a Shame About Ray</a>
                        </li>
                        <li class="even">
                            <a href="#">Come on Feel the Lemonheads</a>
                        </li>
                        <li class="odd">
                            <a href="#">Car, Button, Cloth</a>
                        </li>
                        <li class="even">
                            <a href="#">Varshons</a>
                        </li>
                        <li class="odd">
                            <a href="#">Schoolhouse Rocks</a>
                        </li>
                    </ol>
                </td>
            </tr>
            <tr>
                <td id="trackPane" class="pane" class="pane" colspan="2">
                    <table id="tracks" cellspacing="0" cellpadding="0">
                        <tr class="head" id="trackHead">
                            <th class="play">
                                <a href="#">&nbsp;</a>
                            </th>
                            <th>
                                <a href="#">Name</a>
                            </th>
                            <th>
                                <a href="#">Time</a>
                            </th>
                            <th>
                                <a href="#">Artist</a>
                            </th>
                            <th>
                                <a href="#">Album</a>
                            </th>
                        </tr>
                        <tr class="odd haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Rockin' Stroll</a>
                            </td>
                            <td>
                                <a href="#">1:46</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="even haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Confetti</a>
                            </td>
                            <td>
                                <a href="#">2:44</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="odd haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">It's A Shame About Ray</a>
                            </td>
                            <td>
                                <a href="#">3:07</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="even haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Rudderless</a>
                            </td>
                            <td>
                                <a href="#">3:19</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="odd haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">My Drug Buddy</a>
                            </td>
                            <td>
                                <a href="#">2:51</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="even haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">The Turnpike Down</a>
                            </td>
                            <td>
                                <a href="#">2:33</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="odd haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Bit Part</a>
                            </td>
                            <td>
                                <a href="#">1:51</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="even haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Alison's Starting To Happen</a>
                            </td>
                            <td>
                                <a href="#">1:59</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="odd haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Hannah &amp; Gabi</a>
                            </td>
                            <td>
                                <a href="#">2:40</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="even haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Kitchen</a>
                            </td>
                            <td>
                                <a href="#">2:54</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="odd haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Ceiling Fan In My Spoon</a>
                            </td>
                            <td>
                                <a href="#">1:48</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="even haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Frank Mills</a>
                            </td>
                            <td>
                                <a href="#">1:43</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="odd haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Mrs. Robinson</a>
                            </td>
                            <td>
                                <a href="#">3:45</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="even haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Shaky Ground</a>
                            </td>
                            <td>
                                <a href="#">1:48</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">The Lemonheads</a>
                            </td>
                            <td>
                                <a href="#">It's a Shame About Ray</a>
                            </td>
                        </tr>
                        <tr class="odd haudio">
                            <td class="play">
                                <a href="#"><span class="resolved">-</span><span class="resolving">.</span><span class="notFound">&nbsp;</span></a>
                            </td>
                            <td>
                                <a href="#" class="fn">Take Control</a>
                            </td>
                            <td>
                                <a href="#">2:01</a>
                            </td>
                            <td>
                                <a href="#" class="contributor">James Wheare</a>
                            </td>
                            <td>
                                <a href="#">GCSE Composition</a>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <p><a href="http://github.com/jwheare/player/tree">Code on Github</a> | Made by <a href="http://james.wheare.org/">James Wheare</a> | Work in Progress. Mostly a UI concept for now.</p>
    </div>
    
    <script src="playdar.js"></script>
    <script src="soundmanager2-nodebug-jsmin.js"></script>
    <script>
    
        Playdar.REFRESH_INTERVAL = 100;
        Playdar.MAX_CONCURRENT_RESOLUTIONS = 10;
        var auth_details = {
            name: "Media Player",
            website: "http://player/",
            receiverurl: "http://player/playdarauth.html"
        };
        
        var track_handler = function (track) {
            // Add a classname to the item play cell
            var qid = Playdar.Util.generate_uuid();
            var play = Playdar.Util.select('td.play a', track.element);
            play[0].className = 'resolving q' + qid;
            return qid;
        };
        
        Playdar.setup(auth_details);
        Playdar.client.register_listeners({
            onAuth: function () {
                Playdar.client.autodetect(track_handler);
            }
        });
        var results_handler = function (response, final_answer) {
            if (final_answer) {
                // Register a perfect match only
                var className = 'notFound';
                if (response.results.length) {
                    var result = response.results[0];
                    if (result.score == 1) {
                        var sid = result.sid;
                        className = 'resolved sid' + sid;
                        Playdar.player.register_stream(result);
                    }
                }
                // Update item play button class name
                var qidClass = 'q' + response.qid;
                var play = Playdar.Util.select('.' + qidClass);
                play[0].className = className + ' ' + qidClass;
            }
        };
        Playdar.client.register_results_handler(results_handler);
        
        soundManager.url = 'soundmanager2_flash9.swf';
        soundManager.flashVersion = 9;
        soundManager.onload = function () {
            Playdar.setup_player(soundManager);
            Playdar.client.init();
        };
        
        document.getElementById('tracks').onclick = function (event) {
            // Get the play button link
            var targetLink;
            switch (event.target.nodeName) {
            case 'SPAN':
                if (event.target.parentNode.nodeName == 'A') {
                    targetLink = event.target.parentNode;
                }
                break;
            case 'A':
                targetLink = event.target;
                break;
            }
            if (   targetLink
                && targetLink.parentNode.nodeName == 'TD'
                && targetLink.parentNode.className == 'play'
            ) {
                // Find an SID class and play stream
                var classes = targetLink.className.split(' ');
                for (var i = 0; i < classes.length; i++) {
                    if (classes[i].indexOf('sid') !== -1) {
                        var sid = classes[i].replace('sid', '');
                        Playdar.player.play_stream(sid);
                    }
                }
                return false;
            }
        };
    </script>
</body>
